<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">

<dom-module id="blog-post">
    <style>
        paper-material {
            display: block;
            background: white;
            box-sizing: border-box;
            margin: 16px;
            padding: 16px;
            border-radius: 2px;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            color: blue;
            margin-left: 0;
            background-color: white;
        }

        .content {
            padding-left: 0.7em;
            margin-left: 0.29em;
        }

        .comments {
            color: blue;
            padding-top: 1em;
            padding-bottom: 1em;
            padding-left: .7em;
        }

        h2 {
            margin: 0;
            padding: 0;
        }

    </style>
    <template>
        <paper-material elevation="1">
            <div class="title">
                <paper-button class="title" on-click="clickHandler">{{post.title}}</paper-button>
            </div>
            <div class="content">
                <!--<h2><a href="{{post.url}}">{{post.title}}</a></h2>-->
                <content></content>
            </div>
            <div class="comments">
                <paper-button on-click="clickHandler"><span>{{post.commentCount}}</span> Comments</paper-button>
            </div>
        </paper-material>
    </template>
    <script>
        Polymer({
            is         : 'blog-post',
            properties : {
                title    : String,
                comments : Number
            },
            clickHandler: function(e) {
                console.dir(this.post.seo);
                window.location = '/view/' + this.post.seo;
            }
        });
    </script>
</dom-module>

<dom-module id="blog-post-list">
    <style>
        paper-button.new-post {
            background-color: blue;
            color: white;
        }
        h1 {
            margin-left: 16px;
        }
        .pagination {
            margin-left: 16px;
        }

    </style>
    <template>
        <iron-ajax
                id="blog-post-list-requester"
                auto
                url="/rpc/Blog.sjs"
                method="POST"
                params='{"start":"0", "limit":25}'
                handle-as="json"
                on-response="jsonUpdate"
                verbose="" true
                >
        </iron-ajax>

        <div class="horizontal end-justified layout" style="margin-top: 10px; margin-right: 16px">
            <paper-button raised class="new-post" on-click="newPost">New Post</paper-button>
        </div>

        <h1>Recent Posts</h1>
        <template is="dom-repeat" id="post-list" items="{{list}}">
            <blog-post post="{{item}}">{{item.content}}</blog-post>
        </template>
        <div class="pagination">
            Page <span>{{page}}</span> of <span>{{pages}}</span>
        </div>
    </template>
    <script>
        Polymer({
            is               : 'blog-post-list',
            properties       : {
                page  : {
                    type  : Number,
                    value : 1
                },
                count : Number,
                list  : {
                    type  : Array,
                    value : []
                },
                pages : {
                    type     : Number,
                    computed : 'computePageCount(count)'
                }
            },
            jsonUpdate       : function (event, request) {
                this.count = request.response.count;
                this.list = request.response.list;
                console.dir(this.list);
            },
            computePageCount : function (count) {
                return parseInt(1 + count / 25, 10);
            },
            newPost: function() {
                window.location = '/compose/new';
            }

        });
    </script>
</dom-module>
